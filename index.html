<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Waypoint KMZ Planner - MVP</title>

    <!-- Leaflet (OpenStreetMap map renderer) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
    />

    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css?v=3" />
  </head>

  <body>
    <div id="map"></div>
      <div id="DropOverlay" class="dropOverlay" aria-hidden="true">
      <div class="dropOverlayBox">Drop waypoint .kml/.kmz/.csv file here</div>
    </div>

    <div id="LeftControls" class="leftControls collapsed">
      <div class="leftButtons">
        <button id="ToggleSettingsBtn" type="button" class="dockButton" title="Settings" aria-label="Settings">
          <svg class="dockButtonIcon dockButtonIcon--settings" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M19.14 12.94c.04-.3.06-.62.06-.94s-.02-.64-.07-.94l2.03-1.58a.5.5 0 0 0 .12-.61l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.14 7.14 0 0 0-1.64-.94l-.3-2.59a.5.5 0 0 0-.55-.5h-3.9a.5.5 0 0 0-.55.5l-.3 2.59a7.14 7.14 0 0 0-1.64.94l-2.39-.96a.5.5 0 0 0-.6.22L2.65 8.61a.5.5 0 0 0 .12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.5.5 0 0 0-.12.61l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.38 1.04.7 1.64.94l.3 2.59a.5.5 0 0 0 .55.5h3.9a.5.5 0 0 0 .55-.5l.3-2.59c.6-.24 1.14-.56 1.64-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.61l-2.03-1.58zM12 15.6a3.6 3.6 0 1 1 0-7.2 3.6 3.6 0 0 1 0 7.2z"
              fill="currentColor"
            />
          </svg>
        </button>
        <button id="ToggleWaypointsBtn" type="button" class="dockButton" title="Waypoints" aria-label="Waypoints">
          <svg class="dockButtonIcon dockButtonIcon--waypoints" viewBox="0 0 24 24" width="34" height="34" aria-hidden="true" focusable="false">
            <path
              d="M6 5C16 2 18 9 11.5 11C6 13.5 7.5 19 18 19"
              fill="none"
              stroke="currentColor"
              stroke-width="2.2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="6" cy="5" r="2.2" fill="#ff4d4d" />
            <circle cx="11.5" cy="11" r="2.2" fill="#ff4d4d" />
            <circle cx="18" cy="19" r="2.2" fill="#ff4d4d" />
          </svg>
        </button>
      </div>
      <div class="leftPanel">
        <div id="WaypointSidebar" class="sidebarPanel">
          <div class="panelHeader" id="WaypointPanelHeader">
            <div class="panelTitle">Waypoints</div>
            <div class="waypointHeaderActions">
              <div class="panelHint">Click on the map to add</div>
              <button id="ClearAllWaypointsBtn" type="button" class="panelActionBtn">
                Clear all
              </button>
            </div>
          </div>
          <div id="TravelTimeSummary" class="travelSummary"></div>
          <div id="WaypointList" class="panelBody"></div>
        </div>

        <div id="SettingsPanelLeft" class="sidebarPanel">
          <div class="panelHeader">
            <div class="panelTitle">Settings</div>
            <div class="panelHint">Units & defaults</div>
          </div>
          <div class="panelBody settingsBody">
            <div class="settingsRow">
              <label>
                <input
                  type="radio"
                  name="Units"
                  value="metric"
                  checked
                />
                Metric (m, m/s)
              </label>
            </div>
            <div class="settingsRow">
              <label>
                <input type="radio" name="Units" value="imperial" />
                Imperial (ft, mph)
              </label>
            </div>
            <div class="settingsRow">
              <label class="settingsLabel" for="GlobalAltInput">Global altitude</label>
              <input id="GlobalAltInput" type="number" step="1" value="50" />
            </div>
            <div class="settingsRow">
              <label class="settingsLabel" for="GlobalSpeedInput">Global speed</label>
              <input id="GlobalSpeedInput" type="number" step="0.5" value="8" />
            </div>
            <div class="settingsRow">
              <label>
                <input id="ShowAltLabelsToggle" type="checkbox" checked />
                Show altitude labels
              </label>
              <div class="settingsHint">Shown when zoomed in and &lt;= 350 waypoints.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="RightControls" class="rightControls collapsed">
      <div class="toolsPanel">
        <div class="drawToolStrip" aria-label="Draw shapes">
          <div class="shapeSlider">
            <button id="DrawLineBtn" type="button" class="shapeIconButton" aria-label="Line" title="Line">
              <svg class="toolButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <line x1="4" y1="18" x2="20" y2="6" class="iconStroke" />
                <circle cx="4" cy="18" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="20" cy="6" r="2.2" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
            <button id="DrawPolygonBtn" type="button" class="shapeIconButton" aria-label="Polygon" title="Polygon">
              <svg class="toolButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <polygon points="12,3 20,9 17,20 7,20 4,9" class="iconStroke" />
                <circle cx="12" cy="3" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="20" cy="9" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="17" cy="20" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="7" cy="20" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="4" cy="9" r="2.2" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
            <button id="DrawEllipseBtn" type="button" class="shapeIconButton" aria-label="Ellipse" title="Ellipse">
              <svg
                class="toolButtonIcon toolButtonIcon--ellipse"
                viewBox="0 0 32 32"
                aria-hidden="true"
                focusable="false"
              >
                <ellipse cx="16" cy="16" rx="8.5" ry="11" class="iconStroke" />
                <circle cx="24.5" cy="16" r="2.4" class="iconDot" fill="#ff4d4d" />
                <circle cx="16" cy="5" r="2.4" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
          </div>
        </div>

        <div id="DrawOptionsPanel" class="drawOptionsPanel" aria-hidden="true">
          <div class="panelHeader">
            <div id="DrawOptionsTitle" class="panelTitle">Draw tools</div>
            <div id="DrawOptionsHint" class="panelHint">Select a shape to begin</div>
          </div>
          <div class="panelBody settingsBody">
            <div class="toolSection">
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeSpacingInput">Spacing (m)</label>
                <input id="ShapeSpacingInput" type="number" min="0.1" step="0.1" value="30" />
              </div>
              <div id="ShapeResolutionRow" class="settingsRow">
                <label class="settingsLabel" for="ShapeResolutionSlider">Resolution (m)</label>
                <input
                  id="ShapeResolutionSlider"
                  type="range"
                  min="0"
                  max="200"
                  step="1"
                  value="1"
                />
                <div class="resolutionValue" id="ShapeResolutionValue">Level 1</div>
              </div>
              <div id="ShapeOrientationRow" class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeOrientationSelect">Path orientation</label>
                <select id="ShapeOrientationSelect">
                  <option value="auto" selected>Auto</option>
                  <option value="east-west">East-West</option>
                  <option value="north-south">North-South</option>
                </select>
              </div>
              <div class="settingsRow buttonRow">
                <button id="GenerateFromShapeBtn" type="button" class="toolButton">Generate</button>
                <button id="ConfirmShapeBtn" type="button" class="toolButton secondary">Confirm</button>
                <button id="ClearShapesBtn" type="button" class="toolButton secondary">
                  Clear
                </button>
              </div>
            </div>

            <div id="EllipseOptionsSection">
              <div class="settingsDivider"></div>
              <div class="toolSection">
              <div class="toolTitle">Ellipse options</div>
              <div class="settingsRow buttonRow">
                <button id="EllipseModeBoundaryBtn" type="button" class="toolButton">Border mode</button>
                <button id="EllipseModeCircBtn" type="button" class="toolButton secondary">
                  Circumference
                </button>
              </div>
              <div id="EllipseOrientationRow" class="settingsRow inlineRow">
                <label class="settingsLabel" for="EllipseOrientationSelect">
                  Path orientation
                </label>
                <select id="EllipseOrientationSelect">
                  <option value="auto" selected>Auto</option>
                  <option value="east-west">East-West</option>
                  <option value="north-south">North-South</option>
                </select>
              </div>
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="EllipseResolutionInput">
                  Circumf. spacing (m)
                </label>
                  <input id="EllipseResolutionInput" type="number" min="0" step="1" value="20" />
                </div>
                <div class="settingsRow inlineRow">
                  <label class="settingsLabel" for="EllipseRotationInput">Rotation (deg)</label>
                  <input id="EllipseRotationInput" type="number" step="1" value="0" />
                </div>
                <div class="settingsHint">
                  Ellipse: click center then radius; drag handles to adjust.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="manipulatePanel">
        <div class="panelHeader">
          <div class="panelTitle">Manipulate</div>
          <div class="panelHint">Transform</div>
        </div>
        <div class="panelBody settingsBody">
          <div class="toolSection">
            <div class="toolTitle">Rotate selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="RotationInput">Angle (deg)</label>
              <input
                id="RotationInput"
                type="number"
                step="1"
                min="-180"
                max="180"
                value="0"
              />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyRotationBtn" type="button" class="toolButton">Rotate selected</button>
            </div>
            <div class="settingsHint">Rotates all selected waypoints around their centroid.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Batch edit selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchAltInput">Altitude (m)</label>
              <input id="BatchAltInput" type="number" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchSpeedInput">Speed (m/s)</label>
              <input id="BatchSpeedInput" type="number" step="0.5" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchHeadingInput">Heading (deg)</label>
              <input id="BatchHeadingInput" type="number" min="0" max="360" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchGimbalInput">Gimbal (deg)</label>
              <input id="BatchGimbalInput" type="number" min="-90" max="90" step="1" placeholder="-" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyBatchEditBtn" type="button" class="toolButton">Apply to selected</button>
              <button id="ClearBatchEditBtn" type="button" class="toolButton secondary">Clear</button>
            </div>
            <div class="settingsHint">Leave fields blank to keep current values.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Nudge selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="NudgeStepInput">Step (m)</label>
              <input id="NudgeStepInput" type="number" min="0" step="0.1" value="1" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="NudgeNorthBtn" type="button" class="toolButton">N</button>
              <button id="NudgeSouthBtn" type="button" class="toolButton">S</button>
              <button id="NudgeWestBtn" type="button" class="toolButton">W</button>
              <button id="NudgeEastBtn" type="button" class="toolButton">E</button>
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Offset selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="OffsetDistanceInput">Distance (m)</label>
              <input id="OffsetDistanceInput" type="number" min="0" step="0.1" value="10" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="OffsetBearingInput">Bearing (deg)</label>
              <input id="OffsetBearingInput" type="number" step="1" value="0" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyOffsetBtn" type="button" class="toolButton">Offset selected</button>
            </div>
            <div class="settingsHint">Bearing: 0 = north, 90 = east.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Align selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="LineOffsetInput">Line offset (m)</label>
              <input id="LineOffsetInput" type="number" step="0.1" value="0" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="AlignToLineBtn" type="button" class="toolButton">Align to drawn line</button>
              <button id="AlignToPoiBtn" type="button" class="toolButton secondary">
                Align to POI
              </button>
            </div>
            <div class="settingsHint">POI uses the last search marker.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Reverse points</div>
            <div class="settingsRow buttonRow">
              <button id="ReverseWaypointsBtn" type="button" class="toolButton">
                Reverse points
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="exportPanel">
        <div class="panelHeader">
          <div class="panelTitle">Import/Export</div>
          <div class="panelHint">Load or download</div>
        </div>
        <div class="panelBody settingsBody">
          <div class="toolSection">
            <div class="toolTitle">Export</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="ExportFormatSelect">Format</label>
              <select id="ExportFormatSelect">
                <option value="kml">KML</option>
                <option value="kmz" selected>DJI Fly KMZ</option>
                <option value="csv">CSV</option>
              </select>
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="ExportPathModeSelect">Path mode (DJI)</label>
              <select id="ExportPathModeSelect">
                <option value="curved">Curved</option>
                <option value="straight" selected>Straight</option>
              </select>
            </div>
            <div class="settingsRow buttonRow">
              <button id="ExportNowBtn" type="button" class="toolButton">Download</button>
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Import</div>
            <div class="settingsRow buttonRow">
              <button id="ImportFileBtn" type="button" class="toolButton secondary">
                Import KML/KMZ/CSV
              </button>
              <input
                id="ImportFileInput"
                type="file"
                accept=".kml,.kmz,.csv"
                class="hiddenInput"
              />
            </div>
          </div>
        </div>
      </div>
      <div class="rightButtons">
        <button
          id="ToggleToolsBtn"
          type="button"
          class="dockButton"
          title="Draw"
          aria-label="Draw"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M3 17.25V21h3.75l11.06-11.06-3.75-3.75L3 17.25z"
              fill="currentColor"
            />
            <path
              d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0L15.13 4.9l3.75 3.75 1.83-1.61z"
              fill="#ff4d4d"
            />
          </svg>
        </button>
        <button
          id="ToggleManipulateBtn"
          type="button"
          class="dockButton"
          title="Manipulate"
          aria-label="Manipulate"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <line
              x1="5"
              y1="6"
              x2="19"
              y2="6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="9" cy="6" r="2" fill="currentColor" />
            <line
              x1="5"
              y1="12"
              x2="19"
              y2="12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="15" cy="12" r="2" fill="currentColor" />
            <line
              x1="5"
              y1="18"
              x2="19"
              y2="18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="7" cy="18" r="2" fill="currentColor" />
          </svg>
        </button>
        <button
          id="ExportDockBtn"
          type="button"
          class="dockButton"
          title="Import/Export"
          aria-label="Import/Export"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M0.4 5.2a3.4 3.4 0 0 1 3.4-3.4h8.4l3.2 3.2H20.2a3.4 3.4 0 0 1 3.4 3.4v10.6a3.4 3.4 0 0 1-3.4 3.4H3.8a3.4 3.4 0 0 1-3.4-3.4z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
            <path
              d="M9 8.5v8.5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <path
              d="M7.4 15.8L9 17.4l1.6-1.6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M15 17.4V8.5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <path
              d="M13.4 10.1L15 8.5l1.6 1.6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>
    </div>

    <div class="topbar">
      <div class="searchBox">
        <div class="searchRow">
          <input
            id="SearchInput"
            type="text"
            placeholder="Search a place (city, address, landmark)"
            autocomplete="off"
          />
          <button id="SearchBtn" type="button">Search</button>
        </div>
        <div id="Results" class="results" style="display: none"></div>
      </div>
    </div>

    <!-- Leaflet (OpenStreetMap map renderer) -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="js/coverage.js?v=2"></script>
    <script src="js/ellipse.js?v=2"></script>

    <!-- Custom scripts -->
    <script src="js/app-state.js?v=3"></script>
    <script src="js/helpers.js?v=2"></script>
    <script src="js/ellipse-tools.js?v=2"></script>
    <script src="js/algorithms.js?v=2"></script>
    <script src="js/waypoints.js?v=3"></script>
    <script src="js/export.js?v=2"></script>
    <script src="js/ui.js?v=3"></script>
    <script src="js/history.js?v=3"></script>
    <script src="js/main.js?v=3"></script>
  </body>
</html>
