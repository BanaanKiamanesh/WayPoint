<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Free Waypoint Planner</title>
    <link rel="icon" type="image/png" href="assets/logo_reduced.png" />

    <!-- Leaflet (OpenStreetMap map renderer) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
    />

    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css?v=7" />
  </head>

  <body>
    <div id="map"></div>
      <div id="DropOverlay" class="dropOverlay" aria-hidden="true">
      <div class="dropOverlayBox">Drop waypoint .kml/.kmz/.csv file here</div>
    </div>

    <div id="LeftControls" class="leftControls collapsed">
      <div class="leftButtons">
        <button id="ToggleSettingsBtn" type="button" class="dockButton" title="Settings" aria-label="Settings">
          <svg class="dockButtonIcon dockButtonIcon--settings" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M19.14 12.94c.04-.3.06-.62.06-.94s-.02-.64-.07-.94l2.03-1.58a.5.5 0 0 0 .12-.61l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.14 7.14 0 0 0-1.64-.94l-.3-2.59a.5.5 0 0 0-.55-.5h-3.9a.5.5 0 0 0-.55.5l-.3 2.59a7.14 7.14 0 0 0-1.64.94l-2.39-.96a.5.5 0 0 0-.6.22L2.65 8.61a.5.5 0 0 0 .12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.5.5 0 0 0-.12.61l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.38 1.04.7 1.64.94l.3 2.59a.5.5 0 0 0 .55.5h3.9a.5.5 0 0 0 .55-.5l.3-2.59c.6-.24 1.14-.56 1.64-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.61l-2.03-1.58zM12 15.6a3.6 3.6 0 1 1 0-7.2 3.6 3.6 0 0 1 0 7.2z"
              fill="currentColor"
            />
          </svg>
        </button>
        <button id="ToggleWaypointsBtn" type="button" class="dockButton" title="Waypoints" aria-label="Waypoints">
          <svg class="dockButtonIcon dockButtonIcon--waypoints" viewBox="0 0 24 24" width="34" height="34" aria-hidden="true" focusable="false">
            <path
              d="M6 5C16 2 18 9 11.5 11C6 13.5 7.5 19 18 19"
              fill="none"
              stroke="currentColor"
              stroke-width="2.2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="6" cy="5" r="2.2" fill="#ff4d4d" />
            <circle cx="11.5" cy="11" r="2.2" fill="#ff4d4d" />
            <circle cx="18" cy="19" r="2.2" fill="#ff4d4d" />
          </svg>
        </button>
      </div>
      <div class="leftPanel">
        <div id="WaypointSidebar" class="sidebarPanel">
          <div class="panelHeader" id="WaypointPanelHeader">
            <div class="panelTitle">Waypoints</div>
            <div class="waypointHeaderActions">
              <div class="panelHint">Click on the map to add</div>
              <button id="ClearAllWaypointsBtn" type="button" class="panelActionBtn">
                Clear all
              </button>
            </div>
          </div>
          <div id="TravelTimeSummary" class="travelSummary"></div>
          <div id="WaypointList" class="panelBody"></div>
        </div>

        <div id="SettingsPanelLeft" class="sidebarPanel">
          <div class="panelHeader">
            <div class="panelTitle">Settings</div>
            <div class="panelHint">Units & defaults</div>
          </div>
          <div class="panelBody settingsBody">
            <div class="settingsRow">
              <label>
                <input
                  type="radio"
                  name="Units"
                  value="metric"
                  checked
                />
                Metric (m, m/s)
              </label>
            </div>
            <div class="settingsRow">
              <label>
                <input type="radio" name="Units" value="imperial" />
                Imperial (ft, mph)
              </label>
            </div>
            <div class="settingsRow">
              <label class="settingsLabel" for="GlobalAltInput">Global altitude</label>
              <input id="GlobalAltInput" type="number" step="1" value="50" />
            </div>
            <div class="settingsRow">
              <label class="settingsLabel" for="GlobalSpeedInput">Global speed</label>
              <input id="GlobalSpeedInput" type="number" step="0.5" value="8" />
            </div>
            <div class="settingsRow">
              <label>
                <input id="ShowAltLabelsToggle" type="checkbox" checked />
                Show altitude labels
              </label>
              <div class="settingsHint">Shown when zoomed in and &lt;= 350 waypoints.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="RightControls" class="rightControls collapsed">
      <div class="toolsPanel">
        <div class="drawToolStrip" aria-label="Draw shapes">
          <div class="shapeSlider">
            <button id="DrawLineBtn" type="button" class="shapeIconButton" aria-label="Line" title="Line">
              <svg class="toolButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <line x1="4" y1="18" x2="20" y2="6" class="iconStroke" />
                <circle cx="4" cy="18" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="20" cy="6" r="2.2" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
            <button id="DrawPolygonBtn" type="button" class="shapeIconButton" aria-label="Polygon" title="Polygon">
              <svg class="toolButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <polygon points="12,3 20,9 17,20 7,20 4,9" class="iconStroke" />
                <circle cx="12" cy="3" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="20" cy="9" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="17" cy="20" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="7" cy="20" r="2.2" class="iconDot" fill="#ff4d4d" />
                <circle cx="4" cy="9" r="2.2" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
            <button id="DrawEllipseBtn" type="button" class="shapeIconButton" aria-label="Ellipse" title="Ellipse">
              <svg
                class="toolButtonIcon toolButtonIcon--ellipse"
                viewBox="0 0 32 32"
                aria-hidden="true"
                focusable="false"
              >
                <ellipse cx="16" cy="16" rx="8.5" ry="11" class="iconStroke" />
                <circle cx="24.5" cy="16" r="2.4" class="iconDot" fill="#ff4d4d" />
                <circle cx="16" cy="5" r="2.4" class="iconDot" fill="#ff4d4d" />
              </svg>
            </button>
          </div>
        </div>

        <div id="DrawOptionsPanel" class="drawOptionsPanel" aria-hidden="true">
          <div class="panelHeader">
            <div id="DrawOptionsTitle" class="panelTitle">Draw tools</div>
            <div id="DrawOptionsHint" class="panelHint">Select a shape to begin</div>
          </div>
          <div class="panelBody settingsBody">
            <div class="toolSection">
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeSpacingInput">Spacing (m)</label>
                <input id="ShapeSpacingInput" type="number" min="0.1" step="0.1" value="30" />
              </div>
              <div id="ShapeResolutionRow" class="settingsRow">
                <label class="settingsLabel" for="ShapeResolutionSlider">Resolution (m)</label>
                <input
                  id="ShapeResolutionSlider"
                  type="range"
                  min="0"
                  max="200"
                  step="1"
                  value="1"
                />
                <div class="resolutionValue" id="ShapeResolutionValue">Level 1</div>
              </div>
              <div id="ShapeOrientationRow" class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeOrientationSelect">Path orientation</label>
                <select id="ShapeOrientationSelect">
                  <option value="auto" selected>Auto</option>
                  <option value="east-west">East-West</option>
                  <option value="north-south">North-South</option>
                </select>
              </div>
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeGimbalInput">Gimbal pitch (deg)</label>
                <input id="ShapeGimbalInput" type="number" min="-90" max="90" step="1" placeholder="-" />
              </div>
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="ShapeGimbalRollInput">Gimbal roll (deg)</label>
                <input id="ShapeGimbalRollInput" type="number" min="-90" max="90" step="1" placeholder="-" />
              </div>
              <div id="ShapeOverlapSection" class="toolSection">
                <div class="settingsDivider"></div>
                <div class="toolTitle">Image overlap</div>
                <div class="settingsHint">
                  Sets auto spacing and photo actions for polygon/ellipse generation.
                </div>
                <div class="settingsRow">
                  <label>
                    <input id="ShapeOverlapToggle" type="checkbox" />
                    Enable image overlap
                  </label>
                </div>
                <div class="settingsRow inlineRow">
                  <label class="settingsLabel" for="ShapeOverlapInput">Overlap (%)</label>
                  <input id="ShapeOverlapInput" type="number" min="0" max="95" step="1" value="80" />
                </div>
                <div class="settingsRow inlineRow">
                  <label class="settingsLabel" for="ShapePhotoIntervalInput">Seconds per photo</label>
                  <input id="ShapePhotoIntervalInput" type="number" min="0.2" step="0.1" value="3" />
                </div>
                <div class="settingsRow inlineRow">
                  <label class="settingsLabel" for="ShapePhotoSpeedInput">Speed (m/s)</label>
                  <input id="ShapePhotoSpeedInput" type="number" min="0.1" step="0.1" value="8" />
                </div>
              </div>
              <div class="settingsRow buttonRow">
                <button id="GenerateFromShapeBtn" type="button" class="toolButton">Generate</button>
                <button id="ConfirmShapeBtn" type="button" class="toolButton secondary">Confirm</button>
                <button id="ClearShapesBtn" type="button" class="toolButton secondary">
                  Clear
                </button>
              </div>
            </div>

            <div id="EllipseOptionsSection">
              <div class="settingsDivider"></div>
              <div class="toolSection">
              <div class="toolTitle">Ellipse options</div>
              <div class="settingsRow buttonRow">
                <button id="EllipseModeBoundaryBtn" type="button" class="toolButton">Border mode</button>
                <button id="EllipseModeCircBtn" type="button" class="toolButton secondary">
                  Circumference
                </button>
              </div>
              <div id="EllipseOrientationRow" class="settingsRow inlineRow">
                <label class="settingsLabel" for="EllipseOrientationSelect">
                  Path orientation
                </label>
                <select id="EllipseOrientationSelect">
                  <option value="auto" selected>Auto</option>
                  <option value="east-west">East-West</option>
                  <option value="north-south">North-South</option>
                </select>
              </div>
              <div class="settingsRow inlineRow">
                <label class="settingsLabel" for="EllipseResolutionInput">
                  Circumf. spacing (m)
                </label>
                  <input id="EllipseResolutionInput" type="number" min="0" step="1" value="20" />
                </div>
                <div class="settingsRow inlineRow">
                  <label class="settingsLabel" for="EllipseRotationInput">Rotation (deg)</label>
                  <input id="EllipseRotationInput" type="number" step="1" value="0" />
                </div>
                <div class="settingsHint">
                  Ellipse: click center then radius; drag handles to adjust.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="manipulatePanel">
        <div class="panelHeader">
          <div class="panelTitle">Manipulate</div>
          <div class="panelHint">Transform</div>
        </div>
        <div class="panelBody settingsBody">
          <div class="toolSection">
            <div class="toolTitle">Rotate selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="RotationInput">Angle (deg)</label>
              <input
                id="RotationInput"
                type="number"
                step="1"
                min="-180"
                max="180"
                value="0"
              />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyRotationBtn" type="button" class="toolButton">Rotate selected</button>
            </div>
            <div class="settingsHint">Rotates all selected waypoints around their centroid.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Batch edit selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchAltInput">Altitude (m)</label>
              <input id="BatchAltInput" type="number" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchSpeedInput">Speed (m/s)</label>
              <input id="BatchSpeedInput" type="number" step="0.5" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchHeadingInput">Heading (deg)</label>
              <input id="BatchHeadingInput" type="number" min="0" max="360" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchGimbalInput">Gimbal (deg)</label>
              <input id="BatchGimbalInput" type="number" min="-90" max="90" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchGimbalRollInput">Gimbal roll (deg)</label>
              <input id="BatchGimbalRollInput" type="number" min="-90" max="90" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchHoverInput">Hover (s)</label>
              <input id="BatchHoverInput" type="number" min="0" step="1" placeholder="-" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchCameraActionSelect">Camera action</label>
              <select id="BatchCameraActionSelect">
                <option value="" selected>No change</option>
                <option value="none">None</option>
                <option value="takePhoto">Take photo</option>
                <option value="startRecording">Start recording</option>
                <option value="stopRecording">Stop recording</option>
              </select>
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="BatchZoomInput">Zoom (x)</label>
              <input id="BatchZoomInput" type="number" min="1" step="0.1" placeholder="-" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyBatchEditBtn" type="button" class="toolButton">Apply to selected</button>
              <button id="ClearBatchEditBtn" type="button" class="toolButton secondary">Clear</button>
            </div>
            <div class="settingsHint">Leave fields blank to keep current values.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Nudge selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="NudgeStepInput">Step (m)</label>
              <input id="NudgeStepInput" type="number" min="0" step="0.1" value="1" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="NudgeNorthBtn" type="button" class="toolButton">N</button>
              <button id="NudgeSouthBtn" type="button" class="toolButton">S</button>
              <button id="NudgeWestBtn" type="button" class="toolButton">W</button>
              <button id="NudgeEastBtn" type="button" class="toolButton">E</button>
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Offset selection</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="OffsetDistanceInput">Distance (m)</label>
              <input id="OffsetDistanceInput" type="number" min="0" step="0.1" value="10" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="OffsetBearingInput">Bearing (deg)</label>
              <input id="OffsetBearingInput" type="number" step="1" value="0" />
            </div>
            <div class="settingsRow buttonRow">
              <button id="ApplyOffsetBtn" type="button" class="toolButton">Offset selected</button>
            </div>
            <div class="settingsHint">Bearing: 0 = north, 90 = east.</div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Reverse points</div>
            <div class="settingsRow buttonRow">
              <button id="ReverseWaypointsBtn" type="button" class="toolButton">
                Reverse points
              </button>
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Terrain correction</div>
            <div class="settingsRow">
              <label>
                <input id="TerrainCorrectionToggle" type="checkbox" />
                Enable altitude correction
              </label>
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="TerrainTargetInput">Target AGL (m)</label>
              <input id="TerrainTargetInput" type="number" min="0" step="1" value="50" />
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="TerrainMaxAltInput">Max altitude (m)</label>
              <input id="TerrainMaxAltInput" type="number" min="0" step="1" placeholder="-" />
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Additional settings</div>
            <div class="settingsHint">
              What should the drone do when the mission is completed?
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="MissionFinishSelect">Action on completion</label>
              <select id="MissionFinishSelect">
                <option value="hover" selected>None (Hover)</option>
                <option value="goHome">Return to home</option>
                <option value="autoLand">Land</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="exportPanel">
        <div class="panelHeader">
          <div class="panelTitle">Import/Export</div>
          <div class="panelHint">Load or download</div>
        </div>
        <div class="panelBody settingsBody">
          <div class="toolSection">
            <div class="toolTitle">Export</div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="ExportFormatSelect">Format</label>
              <select id="ExportFormatSelect">
                <option value="kml">KML</option>
                <option value="kmz" selected>DJI Fly KMZ</option>
                <option value="csv">CSV</option>
              </select>
            </div>
            <div class="settingsRow inlineRow">
              <label class="settingsLabel" for="ExportPathModeSelect">Path mode (DJI)</label>
              <select id="ExportPathModeSelect">
                <option value="curved">Curved</option>
                <option value="straight" selected>Straight</option>
              </select>
            </div>
            <div class="settingsRow buttonRow">
              <button id="ExportNowBtn" type="button" class="toolButton">Download</button>
            </div>
          </div>
          <div class="settingsDivider"></div>
          <div class="toolSection">
            <div class="toolTitle">Import</div>
            <div class="settingsRow buttonRow">
              <button id="ImportFileBtn" type="button" class="toolButton secondary">
                Import KML/KMZ/CSV
              </button>
              <input
                id="ImportFileInput"
                type="file"
                accept=".kml,.kmz,.csv"
                class="hiddenInput"
              />
            </div>
            <div class="settingsHint">Or simply drag and drop your KMZ/KML/CSV map file to start the work.</div>
          </div>
        </div>
      </div>
      <div class="rightButtons">
        <button
          id="ToggleToolsBtn"
          type="button"
          class="dockButton"
          title="Draw"
          aria-label="Draw"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M3 17.25V21h3.75l11.06-11.06-3.75-3.75L3 17.25z"
              fill="currentColor"
            />
            <path
              d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0L15.13 4.9l3.75 3.75 1.83-1.61z"
              fill="#ff4d4d"
            />
          </svg>
        </button>
        <button
          id="ToggleManipulateBtn"
          type="button"
          class="dockButton"
          title="Manipulate"
          aria-label="Manipulate"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <line
              x1="5"
              y1="6"
              x2="19"
              y2="6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="9" cy="6" r="2" fill="currentColor" />
            <line
              x1="5"
              y1="12"
              x2="19"
              y2="12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="15" cy="12" r="2" fill="currentColor" />
            <line
              x1="5"
              y1="18"
              x2="19"
              y2="18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <circle cx="7" cy="18" r="2" fill="currentColor" />
          </svg>
        </button>
        <button
          id="ExportDockBtn"
          type="button"
          class="dockButton"
          title="Import/Export"
          aria-label="Import/Export"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M0.4 5.2a3.4 3.4 0 0 1 3.4-3.4h8.4l3.2 3.2H20.2a3.4 3.4 0 0 1 3.4 3.4v10.6a3.4 3.4 0 0 1-3.4 3.4H3.8a3.4 3.4 0 0 1-3.4-3.4z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
            <path
              d="M9 8.5v8.5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <path
              d="M7.4 15.8L9 17.4l1.6-1.6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M15 17.4V8.5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
            <path
              d="M13.4 10.1L15 8.5l1.6 1.6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
        <button
          id="ToggleInfoBtn"
          type="button"
          class="dockButton"
          title="About"
          aria-label="About"
        >
          <svg class="dockButtonIcon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" />
            <circle cx="12" cy="7" r="1.6" fill="currentColor" />
            <line x1="12" y1="10.5" x2="12" y2="16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
      </div>
    </div>

    <div id="InfoOverlay" class="infoOverlay" aria-hidden="true">
      <div class="infoPanel" role="dialog" aria-modal="true" aria-labelledby="InfoTitle">
        <div class="infoHeader">
          <div class="infoBrand">
            <img src="assets/logo_reduced.png" alt="Waypoint Planner logo" class="infoLogo" />
            <div class="infoBrandText">
              <div id="InfoTitle" class="infoTitle">Waypoint Planner</div>
              <div class="infoSubtitle">Free waypoint planning for DJI Fly missions.</div>
            </div>
          </div>
          <div class="infoHeaderActions">
            <button id="InfoBackBtn" type="button" class="toolButton">Back to Planner</button>
          </div>
        </div>

        <div class="infoTabs" role="tablist" aria-label="About tabs">
          <button
            id="InfoTabBtnTutorials"
            class="infoTab active"
            type="button"
            role="tab"
            aria-selected="true"
            aria-controls="InfoTabTutorials"
            data-info-tab="tutorials"
          >
            Tutorials
          </button>
          <button
            id="InfoTabBtnAbout"
            class="infoTab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="InfoTabAbout"
            data-info-tab="about"
          >
            About
          </button>
          <button
            id="InfoTabBtnDrones"
            class="infoTab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="InfoTabDrones"
            data-info-tab="drones"
          >
            Supported drones
          </button>
          <button
            id="InfoTabBtnFaq"
            class="infoTab"
            type="button"
            role="tab"
            aria-selected="false"
            aria-controls="InfoTabFaq"
            data-info-tab="faq"
          >
            FAQ
          </button>
        </div>

        <div class="infoBody">
          <section
            id="InfoTabTutorials"
            class="infoTabPanel active"
            role="tabpanel"
            aria-labelledby="InfoTabBtnTutorials"
            data-info-panel="tutorials"
          >
            <div class="infoSection">
              <h3>Quick start</h3>
              <ol class="infoSteps">
                <li>Search for your location or pan the map to your site.</li>
                <li>Click the map to add waypoints, or use a draw tool to generate them.</li>
                <li>Adjust altitude, speed, heading, gimbal, and camera actions per waypoint.</li>
                <li>Use batch edit and manipulate tools to fine tune the mission.</li>
                <li>Export DJI Fly KMZ and import it in the DJI Fly app.</li>
              </ol>
            </div>

            <div class="infoSection">
              <h3>Map navigation and search</h3>
              <ul class="infoList">
                <li>Use the search bar for city, address, or landmark lookup.</li>
                <li>Scroll or pinch to zoom, drag to pan, and press Space to fit the map.</li>
                <li>Results list is clickable and recenters the map instantly.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Waypoints 101</h3>
              <ul class="infoList">
                <li>Click on the map to drop a waypoint.</li>
                <li>Drag a waypoint on the map to reposition it.</li>
                <li>Shift, Ctrl, or Cmd click to multi-select waypoints.</li>
                <li>Drag any selected waypoint to move the whole selection.</li>
                <li>Use the drag handle in the list to reorder waypoints.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Editing details</h3>
              <ul class="infoList">
                <li>Per waypoint controls: altitude, speed, heading, gimbal pitch, gimbal roll, hover time, camera action, and zoom.</li>
                <li>Use the "Use global" toggles for altitude and speed when you want consistency.</li>
                <li>Estimated distance and time update live, using each waypoint speed.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Draw tools</h3>
              <ul class="infoList">
                <li>Line: draw a path and generate evenly spaced points.</li>
                <li>Polygon: draw a boundary and generate a coverage path.</li>
                <li>Ellipse: click center then radius, then drag handles to refine.</li>
                <li>Use spacing and resolution to control density.</li>
                <li>Set gimbal pitch and roll for generated points only.</li>
                <li>Image overlap (polygon and ellipse): auto spacing and photo waypoints based on overlap and interval.</li>
                <li>Confirm locks the current shape so you can tweak settings without losing it.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Manipulate tools</h3>
              <ul class="infoList">
                <li>Rotate selected points around their centroid.</li>
                <li>Batch edit altitude, speed, heading, gimbal, hover, camera action, and zoom.</li>
                <li>Nudge or offset selections with a distance and bearing.</li>
                <li>Reverse the waypoint order with one click.</li>
                <li>Terrain correction keeps a target AGL with an optional max altitude cap.</li>
                <li>Set the mission completion action (hover, return to home, or land).</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Import and export</h3>
              <ul class="infoList">
                <li>Import KML, KMZ, or CSV from the Import panel or by drag and drop.</li>
                <li>Export DJI Fly KMZ, standard KML, or CSV.</li>
                <li>Choose straight or curved path mode to match DJI Fly behavior.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Visual aids</h3>
              <ul class="infoList">
                <li>Altitude badges appear when zoomed in and under 350 waypoints.</li>
                <li>Switch units between metric and imperial at any time.</li>
              </ul>
            </div>

            <div class="infoSection">
              <h3>Keyboard shortcuts</h3>
              <div class="infoShortcutGrid">
                <div class="infoShortcutHeader">Action</div>
                <div class="infoShortcutHeader">Windows / Linux</div>
                <div class="infoShortcutHeader">macOS</div>

                <div class="infoShortcutAction">Undo</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Ctrl</span> + <span class="infoKbd">Z</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Cmd</span> + <span class="infoKbd">Z</span></div>

                <div class="infoShortcutAction">Redo</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Ctrl</span> + <span class="infoKbd">Y</span> or <span class="infoKbd">Ctrl</span> + <span class="infoKbd">Shift</span> + <span class="infoKbd">Z</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Cmd</span> + <span class="infoKbd">Shift</span> + <span class="infoKbd">Z</span></div>

                <div class="infoShortcutAction">Copy selection</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Ctrl</span> + <span class="infoKbd">C</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Cmd</span> + <span class="infoKbd">C</span></div>

                <div class="infoShortcutAction">Paste selection</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Ctrl</span> + <span class="infoKbd">V</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Cmd</span> + <span class="infoKbd">V</span></div>

                <div class="infoShortcutAction">Delete selection</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Delete</span> or <span class="infoKbd">Backspace</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Delete</span> or <span class="infoKbd">Backspace</span></div>

                <div class="infoShortcutAction">Cancel active draw</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Esc</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Esc</span></div>

                <div class="infoShortcutAction">Fit map to window</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Space</span></div>
                <div class="infoShortcutKeys"><span class="infoKbd">Space</span></div>

                <div class="infoShortcutAction">Search</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Enter</span> to run, <span class="infoKbd">Esc</span> to clear</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Enter</span> to run, <span class="infoKbd">Esc</span> to clear</div>

                <div class="infoShortcutAction">Multi-select waypoints</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Shift</span> or <span class="infoKbd">Ctrl</span> + Click</div>
                <div class="infoShortcutKeys"><span class="infoKbd">Shift</span> or <span class="infoKbd">Cmd</span> + Click</div>

                <div class="infoShortcutAction">Move selection</div>
                <div class="infoShortcutKeys">Drag any selected waypoint</div>
                <div class="infoShortcutKeys">Drag any selected waypoint</div>
              </div>
            </div>
          </section>

          <section
            id="InfoTabAbout"
            class="infoTabPanel"
            role="tabpanel"
            aria-labelledby="InfoTabBtnAbout"
            data-info-panel="about"
          >
            <div class="infoSection">
              <h3>Why Waypoint Planner exists</h3>
              <p class="infoText">
                This project exists because a lot of people charge money for basic waypoint planning. Waypoint Planner keeps it simple, free, and fully in your browser with zero accounts.
              </p>
            </div>

            <div class="infoSection infoCallout">
              <h3>Safety and disclaimer</h3>
              <p class="infoText">
                Waypoint Planner is not affiliated with or endorsed by DJI. You are responsible for safe operation, pre-flight checks, and compliance with local laws and regulations. Fly with caution and use at your own risk.
              </p>
            </div>

            <div class="infoSection">
              <h3>Author</h3>
              <p class="infoText">
                Made by <strong>Banaan Kiamanesh</strong>.
              </p>
              <div class="infoSocialLinks">
                <a
                  class="infoIconLink"
                  href="https://github.com/BanaanKiamanesh/"
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label="Banaan Kiamanesh on GitHub"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      fill="currentColor"
                      d="M12 2.2c-5.42 0-9.82 4.4-9.82 9.82 0 4.33 2.8 8 6.69 9.3.49.09.67-.21.67-.48 0-.24-.01-.87-.01-1.71-2.72.59-3.29-1.14-3.29-1.14-.45-1.15-1.1-1.45-1.1-1.45-.9-.62.07-.61.07-.61 1 .07 1.52 1.03 1.52 1.03.89 1.52 2.34 1.08 2.91.82.09-.64.35-1.08.63-1.32-2.17-.25-4.46-1.09-4.46-4.86 0-1.07.38-1.94 1.02-2.63-.1-.25-.45-1.26.1-2.63 0 0 .84-.27 2.75 1.01a9.5 9.5 0 0 1 5 0c1.91-1.28 2.75-1.01 2.75-1.01.55 1.37.2 2.38.1 2.63.63.69 1.02 1.56 1.02 2.63 0 3.78-2.29 4.61-4.47 4.85.36.31.68.92.68 1.86 0 1.34-.01 2.42-.01 2.75 0 .27.18.58.68.48 3.89-1.3 6.68-4.97 6.68-9.3 0-5.42-4.4-9.82-9.82-9.82z"
                    />
                  </svg>
                  <span class="srOnly">GitHub</span>
                </a>
                <a
                  class="infoIconLink"
                  href="https://www.linkedin.com/in/banaankiamanesh/"
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label="Banaan Kiamanesh on LinkedIn"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      fill="currentColor"
                      d="M4.98 3.5C3.88 3.5 3 4.39 3 5.5s.88 2 1.98 2 2-.9 2-2-.9-2-2-2zM3.5 8.75h3v11.75h-3V8.75zM9.5 8.75h2.88v1.6h.04c.4-.76 1.38-1.56 2.84-1.56 3.04 0 3.6 2 3.6 4.6v7.11h-3v-6.3c0-1.5-.02-3.43-2.09-3.43-2.1 0-2.42 1.64-2.42 3.33v6.4h-3V8.75z"
                    />
                  </svg>
                  <span class="srOnly">LinkedIn</span>
                </a>
              </div>
            </div>

            <div class="infoSection">
              <h3>Contact</h3>
              <p class="infoText">
                Email: <strong>banaankiamanesh@gmail.com</strong> (not product support).
                If you run into issues, open a GitHub issue and I will try to solve it.
              </p>
            </div>
          </section>

          <section
            id="InfoTabDrones"
            class="infoTabPanel"
            role="tabpanel"
            aria-labelledby="InfoTabBtnDrones"
            data-info-panel="drones"
          >
            <div class="infoSection">
              <h3>Supported DJI Fly drones</h3>
              <p class="infoText">
                These models support DJI Fly Waypoint Flight. Availability can vary by firmware or app version.
              </p>
              <div class="infoCardGrid">
                <a class="infoCard" href="https://www.dji.com/mini-5-pro" target="_blank" rel="noopener noreferrer">DJI Mini 5 Pro</a>
                <a class="infoCard" href="https://www.dji.com/mini-4-pro" target="_blank" rel="noopener noreferrer">DJI Mini 4 Pro</a>
                <a class="infoCard" href="https://www.dji.com/air-3" target="_blank" rel="noopener noreferrer">DJI Air 3</a>
                <a class="infoCard" href="https://www.dji.com/air-3s" target="_blank" rel="noopener noreferrer">DJI Air 3S</a>
                <a class="infoCard" href="https://www.dji.com/mavic-3" target="_blank" rel="noopener noreferrer">DJI Mavic 3</a>
                <a class="infoCard" href="https://www.dji.com/mavic-3-classic" target="_blank" rel="noopener noreferrer">DJI Mavic 3 Classic</a>
                <a class="infoCard" href="https://www.dji.com/mavic-3-pro" target="_blank" rel="noopener noreferrer">DJI Mavic 3 Pro</a>
                <a class="infoCard" href="https://www.dji.com/mavic-4-pro" target="_blank" rel="noopener noreferrer">DJI Mavic 4 Pro</a>
              </div>
            </div>
          </section>

          <section
            id="InfoTabFaq"
            class="infoTabPanel"
            role="tabpanel"
            aria-labelledby="InfoTabBtnFaq"
            data-info-panel="faq"
          >
            <div class="infoSection">
              <h3>Frequently asked questions</h3>
              <div class="infoFaq">
                <details>
                  <summary>Is Waypoint Planner affiliated with DJI?</summary>
                  <p>No. This is an independent community project and it is not endorsed by DJI. It simply generates mission files that DJI Fly can read on supported aircraft.</p>
                </details>
                <details>
                  <summary>Do you upload my missions or store my data?</summary>
                  <p>Nope. Everything runs locally in your browser and no account is required. Your files stay on your device unless you explicitly export or share them.</p>
                </details>
                <details>
                  <summary>Why does DJI Fly adjust settings when I import a mission?</summary>
                  <p>DJI Fly may adjust speed, path smoothing, or other parameters based on aircraft limits, safety rules, and firmware behavior. This is normal, especially when importing missions created on another device or app version.</p>
                </details>
                <details>
                  <summary>My KMZ does not import or shows nothing. What should I try?</summary>
                  <p>First confirm your aircraft supports Waypoint Flight and that DJI Fly and firmware are up to date. Try a short mission with only a few waypoints, and export again using straight path mode. If it still fails, test the file in a KMZ viewer and share details in a GitHub issue.</p>
                </details>
                <details>
                  <summary>Is there product support?</summary>
                  <p>There is no official support desk. Please open a GitHub issue with steps to reproduce, the file you imported, and screenshots. I will try to help when I can.</p>
                </details>
                <details>
                  <summary>What about drone flight regulations?</summary>
                  <p>Follow local laws, altitude limits, and no-fly zones. Always maintain visual line of sight, respect privacy, and avoid flying over crowds or sensitive areas. When in doubt, check your local aviation authority guidance.</p>
                </details>
                <details>
                  <summary>Can I use this on mobile?</summary>
                  <p>It works in modern mobile browsers, but desktop is recommended for precision edits and drag tools. On mobile, use pinch to zoom and be mindful of smaller hit targets.</p>
                </details>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div class="topbar">
      <div class="searchBox">
        <div class="searchRow">
          <input
            id="SearchInput"
            type="text"
            placeholder="Search a place (city, address, landmark)"
            autocomplete="off"
          />
          <button id="SearchBtn" type="button">Search</button>
        </div>
        <div id="Results" class="results" style="display: none"></div>
      </div>
    </div>

    <!-- Leaflet (OpenStreetMap map renderer) -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="js/coverage.js?v=2"></script>
    <script src="js/ellipse.js?v=2"></script>

    <!-- Custom scripts -->
      <script src="js/app-state.js?v=9"></script>
      <script src="js/helpers.js?v=5"></script>
      <script src="js/terrain.js?v=1"></script>
    <script src="js/ellipse-tools.js?v=2"></script>
    <script src="js/algorithms.js?v=2"></script>
    <script src="js/waypoints.js?v=4"></script>
      <script src="js/export.js?v=5"></script>
      <script src="js/ui.js?v=7"></script>
      <script src="js/history.js?v=7"></script>
      <script src="js/main.js?v=9"></script>
  </body>
</html>
